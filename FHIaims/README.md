# FHI-Aims output
When preparing DFT calculations for, you can end up with 1000s of calculations. For this reason, it is important to create a workflow to grep all data from outputs.

For educational purposes, I copied 3 folders from my dataset of water clusters. Each folder contains

`aims.out` - output of a FHI-Aims calculation. This is what you want to read.

`aimsRun.py` - Python file to run a single point calculation

`geometry.in` - structure file needed for FHI-Aims calculation. This was here generated by ASE from `aimsRun.py` file

`control.in` - setting file for a calculation. You can see inside what settings I used for this calculation

`parameters.ase` - some random file created by ASE

`w09_****.xyz` - xyz file originally used in `aimsRun.py` 

The goal here is to create 1 xyz file that will contain all 3 structures with Aims energy saved as `atoms.info` entry, and forces as `atoms.arrays` entry. This can be done by various ways.

As an example of what you want get I will use folder `w09_0055/`

Energy:
```
Total energy of the DFT / Hartree-Fock s.c.f. calculation      :         -18731.546478721 eV
```

Forces:
```
  Total atomic forces (unitary forces cleaned) [eV/Ang]:
  |    1          0.191311586692633E+00         -0.212413462938959E-01         -0.131044916606543E+00
  |    2         -0.423011970695839E-01         -0.203818132065775E-01          0.116847926699753E-01
  |    3         -0.153608249628103E+00          0.980935987676840E-01          0.591567635143124E-01
  |    4          0.191778717434176E+00          0.290682436148561E+00          0.129066364796457E+00
  |    5          0.561795702980185E-01         -0.215797971128580E+00         -0.898648509621545E-01
  |    6         -0.347664914218153E+00         -0.155990528309251E+00         -0.834481757996925E-01
  |    7         -0.119749564876695E+00          0.701594977272819E-01         -0.222276407412356E+00
  |    8          0.985078543637109E-01         -0.223460698310006E+00          0.138646713517504E+00
  |    9          0.569629570410850E-01          0.161090853526040E-01          0.117190747662002E+00
  |   10         -0.280254033837405E+00         -0.208472713211025E+00         -0.690361590513796E-01
  |   11          0.124071940735744E+00          0.192114430388169E+00          0.609682270720096E-01
  |   12          0.745977425293707E-01          0.185491640219396E-02         -0.146953903534282E-02
  |   13         -0.409781218939722E+00         -0.257179139835559E+00          0.166142922805728E+00
  |   14          0.382455417060837E+00          0.627478944309300E+00          0.883756122522650E-01
  |   15          0.818351260340804E-01         -0.116303212167508E+00         -0.123400069274493E+00
  |   16          0.207475509469880E+00         -0.455991277564970E+00         -0.101351209137090E+00
  |   17         -0.257097112193281E+00          0.276694106505095E+00          0.361069272444924E-01
  |   18          0.251739570928090E-01          0.121998523033013E+00          0.654323669319651E-01
  |   19         -0.185041316283960E+00          0.269196797372340E+00          0.149039064393561E+00
  |   20          0.111858157556482E+00         -0.182422574746501E+00         -0.302559660287896E+00
  |   21          0.960137706937676E-01         -0.968686671183113E-01          0.185366236277856E-01
  |   22          0.121277632141517E+00         -0.549281504179947E-02         -0.200451814823730E+00
  |   23         -0.128584828440203E+00          0.581233875086351E-01         -0.520059663750262E-01
  |   24          0.127868114264909E+00         -0.765352652456500E-01          0.355588807685040E+00
  |   25         -0.160174478866419E+00          0.347362517222138E-01          0.118689040199241E+00
  |   26          0.660699001048758E-01         -0.416451351264334E-01         -0.162787962205786E+00
  |   27          0.708189608396277E-01          0.205411820689769E-01          0.250717565991506E-01
```
These are "easily grepable" formats, that can be simply manipulated with `grep` command and `awk` via CLI. 

### My way
In my project, I needed more data than just forces and energy, so I created `aims_ext.sh` file to load different charges from aims output also. Final result (I will load energy, forces and hirshfeld charges, last one can be omitted) can be obtained by
```Bash
for folder in */; do cd $folder ; cp ../aims_ext.sh . ; bash aims_ext.sh ${folder::-1}.xyz energy forces hirshfeld ; cat loaded_file.xyz >> ../all_struc.xyz ; cd .. ; done
```

### ASE 
It is easy to read aims output with ASE if you need only energy and forces. (For other stuff, you need to change ASE code itself, I am not a big fan of this, but it is an option). I think this change now with a recent FHI-Aims version 3.23. I am still on a version before, so not to be dependent on the version of ASE, I wrote my own python function to read Aims output, which is based on the 3.22.1 version of ASE aims output reading. This code is from my repo JobCrafts, which you can have a look on, but it is undocumented mess. 
```Python
import numpy as np
import ase.io
import os


def read_aims_output(mol=None,mol_file_name=None,mol_file_format="extxyz",output_name="aims.out",properties=["energy"],xc=None,spin=False):
    '''
    I was (heavily) inspired by the ASE, but adding reading of hirshfeld charges was easir this way,
    becaues I have a small brain
    '''
    if mol_file_name == None:
        assert type(mol) != list
        natoms = len(mol)
    elif mol == None:
        mol = ase.io.read(mol_file_name,format=mol_file_format)
        natoms = len(mol)
    elif mol == None and mol_file_name == None:
        print("specify name of the file to load or ase.Atoms object")
        exit()
    elif mol != None and mol_file_name != None:
        print("You set up both, mol and mol_file_name, assuming that mol is what to use")
        assert type(mol) != list
        natoms = len(mol)
    
    output_file = open(output_name,"r").readlines()
    results = {}
    if "energy" in properties:
        for line in output_file:
            if line.rfind('Total energy corrected') > -1:
                E0 = float(line.split()[5])
        results["energy"] = E0

    if "forces" in properties:
        forces = np.zeros([natoms, 3])
        for n, line in enumerate(output_file):
            if line.rfind('Total atomic forces') > -1:
                for iatom in range(natoms):
                    data = output_file[n + iatom + 1].split()
                    for iforce in range(3):
                        forces[iatom, iforce] = float(data[2 + iforce])
        results['forces'] = forces
    
    if "hirshfeld" in properties:
        hirshfeld = []
        for n,line in enumerate(output_file):
            if (line.rfind("Performing Hirshfeld analysis of fragment charges and moments.")) >-1:
                count = 0
                if xc == "pbesol":
                    for iatom in range(natoms):
                        if spin:
                            data = output_file[n + iatom*11 + 7].split()
                        else:
                            data = output_file[n + iatom*10 + 7].split()
                        hirshfeld.append(float(data[-1]))
                else:
                    for iatom in range(natoms):
                        if spin:
                            data = output_file[n + iatom*11 + 3].split()
                        else:
                            data = output_file[n + iatom*10 + 3].split()
                        hirshfeld.append(float(data[-1]))
        results['hirshfeld'] = np.array(hirshfeld)

    return results
```